$ = jQuery;

function Omnisense(a,b){this.BASE_URL="https://"+b+".app.omnisense.io/api/v1",this.key_api=a,this.email=null,this.trid=null,this.timer=null,this.from="website",this.eventSendType="immediate",this.events=[],this.domain=null;var c=this;this.setEmail=function(a){this.email=a},this.setOrigin=function(a){this.from=a},this.setEventSendType=function(a){this.eventSendType=a},this.trackEvent=function(a,b,c){this.events.push({identifier:a,segments:b,callback:c}),"immediate"!=this.eventSendType&&null==c||this.flushEvents()},this.flushEvents=function(){null==this.email&&null==this.trid||($.each(this.events,function(a,b){data={user_event:{identifier:b.identifier,segments:b.segments}},data.key_api=c.key_api,null!=c.email&&c.email.length>0&&(data.email=c.email),null!=c.trid&&c.trid.length>0&&(data.trid=c.trid),$.ajax({url:c.BASE_URL+"/user_event",type:"GET",contentType:"application/json",dataType:"jsonp",data:data,success:function(a){null!=b.callback&&b.callback()},complete:function(a){}})}),this.events=[])},this.trackSession=function(a){null==this.email&&null==this.trid||(data={key_api:this.key_api,from:this.from,session_end:a},null!=this.email&&this.email.length>0&&(data.email=this.email),null!=this.trid&&this.trid.length>0&&(data.trid=this.trid),$.ajax({url:this.BASE_URL+"/user_session",type:"GET",contentType:"application/json",dataType:"jsonp",data:data,success:function(a){},complete:function(b){200==b.status&&"queue"==c.eventSendType&&c.flushEvents(),a||(c.timer=setTimeout(function(){c.trackSession(!1)},25e3))}}))},this.updateUser=function(a,b){null!=this.email&&(null==a?a={email:this.email}:$.extend(a,{email:this.email})),data={key_api:this.key_api},null!=a&&$.extend(data,{user:a}),null!=b&&$.extend(data,{metadata:b}),null!=this.trid&&$.extend(data,{trid:this.trid}),$.ajax({url:this.BASE_URL+"/subscriber",type:"GET",contentType:"application/json",dataType:"jsonp",data:data,success:function(a){null!=a&&null!=a.trid&&(ts=null==c.trid,c.trid=a.trid,$.oc("trid",a.trid,{expires:365,path:"/",domain:c.domain}),ts&&(document.hasFocus()?c.trackSession(!1):c.flushEvents()))}})},this.start=function(){this.extractTrID(),$(window).focus(function(){c.trackSession(!1)}),$(window).blur(function(){clearTimeout(c.timer)}),$(window).on("beforeunload ",function(){c.trackSession(!0),clearTimeout(c.timer)}),null==this.trid?this.updateUser(null):this.trackSession(!1)},this.extractTrID=function(){this.trid=this.getUrlParameter("trid"),null!=this.trid?$.oc("trid",this.trid,{expires:365,path:"/",domain:this.domain}):this.trid=$.oc("trid")},this.domainAvailability=function(a){this.domain=a},this.getUrlParameter=function(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return e[1]}}}!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function c(a){return a}function d(a){return decodeURIComponent(a.replace(b," "))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return f.json?JSON.parse(a):a}catch(a){}}var b=/\+/g,f=a.oc=function(b,g,h){if(void 0!==g){if(h=a.extend({},f.defaults,h),"number"==typeof h.expires){var i=h.expires,j=h.expires=new Date;j.setDate(j.getDate()+i)}return g=f.json?JSON.stringify(g):String(g),document.cookie=[f.raw?b:encodeURIComponent(b),"=",f.raw?g:encodeURIComponent(g),h.expires?"; expires="+h.expires.toUTCString():"",h.path?"; path="+h.path:"",h.domain?"; domain="+h.domain:"",h.secure?"; secure":""].join("")}for(var k=f.raw?c:d,l=document.cookie.split("; "),m=b?void 0:{},n=0,o=l.length;n<o;n++){var p=l[n].split("="),q=k(p.shift()),r=k(p.join("="));if(b&&b===q){m=e(r);break}b||(m[q]=e(r))}return m};f.defaults={},a.roc=function(b,c){return void 0!==a.oc(b)&&(a.oc(b,"",a.extend({},c,{expires:-1})),!0)}});
